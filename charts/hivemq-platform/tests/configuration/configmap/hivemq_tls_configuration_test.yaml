suite: HiveMQ Platform Configuration as ConfigMap - TLS Placeholders Tests
templates:
  - hivemq-configuration.yml
release:
  name: platform-release
set:
  config.createAs: ConfigMap
tests:

  ################################################################################
  # KEYSTORE SECRET SHARING MATRIX
  # Testing all combinations of keystoreSecretName and keystorePasswordSecretName
  ################################################################################

  - it: same keystoreSecretName, same keystorePasswordSecretName, same keystorePasswordSecretKey - should deduplicate
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_pass-key_keystore_pass\}'

  - it: same keystoreSecretName, same keystorePasswordSecretName, different keystorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_pass-key-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_pass-key-2_keystore_pass\}'

  - it: same keystoreSecretName, different keystorePasswordSecretName, same keystorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "pass-secret-1"
          keystorePasswordSecretKey: "pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "pass-secret-2"
          keystorePasswordSecretKey: "pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_pass-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_pass-key_keystore_pass\}'

  - it: same keystoreSecretName, different keystorePasswordSecretName, different keystorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "pass-secret-1"
          keystorePasswordSecretKey: "pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "pass-secret-2"
          keystorePasswordSecretKey: "pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_pass-key-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_pass-key-2_keystore_pass\}'

  - it: different keystoreSecretName, same keystorePasswordSecretName, same keystorePasswordSecretKey - should deduplicate
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_pass-key_keystore_pass\}'

  - it: different keystoreSecretName, same keystorePasswordSecretName, different keystorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_pass-key-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_pass-key-2_keystore_pass\}'

  - it: different keystoreSecretName, different keystorePasswordSecretName, same keystorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "pass-secret-1"
          keystorePasswordSecretKey: "pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "pass-secret-2"
          keystorePasswordSecretKey: "pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_pass-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_pass-key_keystore_pass\}'

  - it: different keystoreSecretName, different keystorePasswordSecretName, different keystorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "pass-secret-1"
          keystorePasswordSecretKey: "pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "pass-secret-2"
          keystorePasswordSecretKey: "pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_pass-key-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_pass-key-2_keystore_pass\}'

  ################################################################################
  # KEYSTORE WITH keystoreSecretKey VARIATIONS
  ################################################################################

  - it: same keystoreSecretName with different keystoreSecretKey, same password secret - should deduplicate password
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystoreSecretKey: "key-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystoreSecretKey: "key-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_pass-key_keystore_pass\}'

  - it: same keystoreSecretName with different keystoreSecretKey, different password secret - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystoreSecretKey: "key-1"
          keystorePasswordSecretName: "pass-secret-1"
          keystorePasswordSecretKey: "pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystoreSecretKey: "key-2"
          keystorePasswordSecretName: "pass-secret-2"
          keystorePasswordSecretKey: "pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_pass-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_pass-key_keystore_pass\}'

  ################################################################################
  # KEYSTORE PRIVATE PASSWORD SHARING MATRIX
  ################################################################################

  - it: same keystorePasswordSecretName, same keystorePasswordSecretKey, same keystorePrivatePasswordSecretKey - should deduplicate both
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-pass_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_private-pass_keystore_private_pass\}'

  - it: same keystorePasswordSecretName, same keystorePasswordSecretKey, different keystorePrivatePasswordSecretKey - deduplicate keystore only
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-pass_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_private-pass-1_keystore_private_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_private-pass-2_keystore_private_pass\}'

  - it: same keystorePasswordSecretName, different keystorePasswordSecretKey, same keystorePrivatePasswordSecretKey - deduplicate private only
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass-1"
          keystorePrivatePasswordSecretKey: "private-pass"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass-2"
          keystorePrivatePasswordSecretKey: "private-pass"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-pass-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-pass-2_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_private-pass_keystore_private_pass\}'

  - it: same keystorePasswordSecretName, different keystorePasswordSecretKey, different keystorePrivatePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass-1"
          keystorePrivatePasswordSecretKey: "private-pass-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-pass-2"
          keystorePrivatePasswordSecretKey: "private-pass-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-pass-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-pass-2_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_private-pass-1_keystore_private_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_private-pass-2_keystore_private_pass\}'

  - it: different keystorePasswordSecretName, same keystorePasswordSecretKey, same keystorePrivatePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "pass-secret-1"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "pass-secret-2"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_keystore-pass_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_keystore-pass_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_private-pass_keystore_private_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_private-pass_keystore_private_pass\}'

  ################################################################################
  # TRUSTSTORE SECRET SHARING MATRIX
  # Testing all combinations of truststoreSecretName and truststorePasswordSecretName
  ################################################################################

  - it: same truststoreSecretName, same truststorePasswordSecretName, same truststorePasswordSecretKey - should deduplicate
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-2_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_trust-pass-key_truststore_pass\}'

  - it: same truststoreSecretName, same truststorePasswordSecretName, different truststorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_trust-pass-key-1_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_trust-pass-key-2_truststore_pass\}'

  - it: same truststoreSecretName, different truststorePasswordSecretName, same truststorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "trust-pass-secret-1"
          truststorePasswordSecretKey: "trust-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "trust-pass-secret-2"
          truststorePasswordSecretKey: "trust-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-1_trust-pass-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-2_trust-pass-key_truststore_pass\}'

  - it: same truststoreSecretName, different truststorePasswordSecretName, different truststorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "trust-pass-secret-1"
          truststorePasswordSecretKey: "trust-pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "trust-pass-secret-2"
          truststorePasswordSecretKey: "trust-pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-1_trust-pass-key-1_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-2_trust-pass-key-2_truststore_pass\}'

  - it: different truststoreSecretName, same truststorePasswordSecretName, same truststorePasswordSecretKey - should deduplicate
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_trust-pass-key_truststore_pass\}'

  - it: different truststoreSecretName, same truststorePasswordSecretName, different truststorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_trust-pass-key-1_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_trust-pass-key-2_truststore_pass\}'

  - it: different truststoreSecretName, different truststorePasswordSecretName, same truststorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "trust-pass-secret-1"
          truststorePasswordSecretKey: "trust-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "trust-pass-secret-2"
          truststorePasswordSecretKey: "trust-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-1_trust-pass-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-2_trust-pass-key_truststore_pass\}'

  - it: different truststoreSecretName, different truststorePasswordSecretName, different truststorePasswordSecretKey - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "trust-pass-secret-1"
          truststorePasswordSecretKey: "trust-pass-key-1"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "trust-pass-secret-2"
          truststorePasswordSecretKey: "trust-pass-key-2"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-1_trust-pass-key-1_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-2_trust-pass-key-2_truststore_pass\}'

  ################################################################################
  # TRUSTSTORE WITH truststoreSecretKey VARIATIONS
  ################################################################################

  - it: same truststoreSecretName with different truststoreSecretKey, same password secret - should deduplicate password
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststoreSecretKey: "trust-key-1"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststoreSecretKey: "trust-key-2"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "trust-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_trust-pass-key_truststore_pass\}'

  - it: same truststoreSecretName with different truststoreSecretKey, different password secret - no deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststoreSecretKey: "trust-key-1"
          truststorePasswordSecretName: "trust-pass-secret-1"
          truststorePasswordSecretKey: "trust-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststoreSecretKey: "trust-key-2"
          truststorePasswordSecretName: "trust-pass-secret-2"
          truststorePasswordSecretKey: "trust-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-1_trust-pass-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret-2_trust-pass-key_truststore_pass\}'

  ################################################################################
  # CROSS-SHARING: keystorePasswordSecretName = truststorePasswordSecretName
  ################################################################################

  - it: same secret for keystore and truststore passwords, different keys - should deduplicate independently
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-password-secret"
          keystorePasswordSecretKey: "keystore-pass-key"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "shared-password-secret"
          truststorePasswordSecretKey: "truststore-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-password-secret"
          keystorePasswordSecretKey: "keystore-pass-key"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "shared-password-secret"
          truststorePasswordSecretKey: "truststore-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-password-secret_keystore-pass-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-password-secret_truststore-pass-key_truststore_pass\}'

  - it: same secret for keystore and truststore passwords, service 1 uses both, service 2 uses keystore only
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-password-secret"
          keystorePasswordSecretKey: "keystore-pass-key"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "shared-password-secret"
          truststorePasswordSecretKey: "truststore-pass-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-password-secret"
          keystorePasswordSecretKey: "keystore-pass-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-password-secret_keystore-pass-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-password-secret_truststore-pass-key_truststore_pass\}'

  - it: keystorePasswordSecretName equals truststorePasswordSecretName with private key password
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "all-passwords-secret"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "all-passwords-secret"
          truststorePasswordSecretKey: "truststore-pass"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "all-passwords-secret"
          keystorePasswordSecretKey: "keystore-pass"
          keystorePrivatePasswordSecretKey: "private-pass"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "all-passwords-secret"
          truststorePasswordSecretKey: "truststore-pass"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_all-passwords-secret_keystore-pass_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_all-passwords-secret_private-pass_keystore_private_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_all-passwords-secret_truststore-pass_truststore_pass\}'

  ################################################################################
  # CROSS-SHARING: keystorePasswordSecretName = keystoreSecretName
  ################################################################################

  - it: keystorePasswordSecretName equals keystoreSecretName - password stored in keystore secret
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-with-passwords"
          keystorePasswordSecretName: "keystore-with-passwords"
          keystorePasswordSecretKey: "password-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-with-passwords"
          keystorePasswordSecretName: "keystore-with-passwords"
          keystorePasswordSecretKey: "password-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-with-passwords_password-key_keystore_pass\}'

  - it: keystorePasswordSecretName equals keystoreSecretName with private key
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-with-passwords"
          keystorePasswordSecretName: "keystore-with-passwords"
          keystorePasswordSecretKey: "password-key"
          keystorePrivatePasswordSecretKey: "private-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-with-passwords"
          keystorePasswordSecretName: "keystore-with-passwords"
          keystorePasswordSecretKey: "password-key"
          keystorePrivatePasswordSecretKey: "private-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-with-passwords_password-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-with-passwords_private-key_keystore_private_pass\}'

  ################################################################################
  # CROSS-SHARING: truststorePasswordSecretName = truststoreSecretName
  ################################################################################

  - it: truststorePasswordSecretName equals truststoreSecretName - password stored in truststore secret
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-with-password"
          truststorePasswordSecretName: "truststore-with-password"
          truststorePasswordSecretKey: "password-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-with-password"
          truststorePasswordSecretName: "truststore-with-password"
          truststorePasswordSecretKey: "password-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_truststore-with-password_password-key_truststore_pass\}'

  ################################################################################
  # COMBINED MATRIX: All secrets sharing at once
  ################################################################################

  - it: All services share ALL secrets - keystorePasswordSecretName and truststorePasswordSecretName
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-pass"
          truststorePasswordSecretKey: "truststore-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-pass"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_truststore-key_truststore_pass\}'

  - it: All services share keystorePasswordSecretName but different truststorePasswordSecretName
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-keystore-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "trust-pass-1"
          truststorePasswordSecretKey: "truststore-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-keystore-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "trust-pass-2"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-keystore-pass_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-1_truststore-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-2_truststore-key_truststore_pass\}'

  - it: All services share truststorePasswordSecretName but different keystorePasswordSecretName
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "keystore-pass-1"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "shared-truststore-pass"
          truststorePasswordSecretKey: "truststore-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "keystore-pass-2"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "shared-truststore-pass"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-pass-1_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-pass-2_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-truststore-pass_truststore-key_truststore_pass\}'

  - it: Share keystoreSecretName and truststoreSecretName but different password secrets
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystoreSecretKey: "key-1"
          keystorePasswordSecretName: "keystore-pass-1"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "shared-truststore"
          truststoreSecretKey: "trust-1"
          truststorePasswordSecretName: "trust-pass-1"
          truststorePasswordSecretKey: "truststore-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystoreSecretKey: "key-2"
          keystorePasswordSecretName: "keystore-pass-2"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "shared-truststore"
          truststoreSecretKey: "trust-2"
          truststorePasswordSecretName: "trust-pass-2"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-pass-1_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-pass-2_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-1_truststore-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-2_truststore-key_truststore_pass\}'

  - it: Share keystoreSecretName and keystorePasswordSecretName, different truststore configs
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-keystore-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "trust-pass-1"
          truststorePasswordSecretKey: "truststore-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "shared-keystore-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "trust-pass-2"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-keystore-pass_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-1_truststore-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-2_truststore-key_truststore_pass\}'

  - it: Share truststoreSecretName and truststorePasswordSecretName, different keystore configs
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "keystore-pass-1"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-truststore-pass"
          truststorePasswordSecretKey: "truststore-key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "keystore-pass-2"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "shared-truststore-pass"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-pass-1_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-pass-2_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-truststore-pass_truststore-key_truststore_pass\}'

  ################################################################################
  # INLINE VS SECRET MIXING WITH SHARING
  ################################################################################

  - it: Service 1 inline password, Service 2 secret password, same keystoreSecretName
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePasswordSecretName: "pass-secret"
          keystorePasswordSecretKey: "keystore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-keystore_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret_keystore-key_keystore_pass\}'

  - it: Service 1 inline password, Service 2 secret password, different keystoreSecretName
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "pass-secret"
          keystorePasswordSecretKey: "keystore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret_keystore-key_keystore_pass\}'

  - it: Service 1 inline truststore password, Service 2 secret password, same truststoreSecretName
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePassword: "dHJ1c3QtY2hhbmdlbWUK" # trust-changeme
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePasswordSecretName: "trust-pass-secret"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-1_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_keystore-2_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-truststore_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-secret_truststore-key_truststore_pass\}'

  - it: Both services inline passwords, same keystoreSecretName and truststoreSecretName
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "shared-keystore"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePassword: "dHJ1c3QtY2hhbmdlbWUK" # trust-changeme
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "shared-keystore"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "shared-truststore"
          truststorePassword: "dHJ1c3QtY2hhbmdlbWUK" # trust-changeme
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-keystore_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-truststore_truststore_pass\}'

  ################################################################################
  # THREE+ SERVICES SHARING SCENARIOS
  ################################################################################

  - it: Three services sharing same keystorePasswordSecretName - full deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-key"
        - type: websocket
          exposed: true
          containerPort: 8000
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-key"
        - type: control-center
          exposed: true
          containerPort: 8080
          keystoreSecretName: "keystore-3"
          keystorePasswordSecretName: "shared-pass"
          keystorePasswordSecretKey: "keystore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-pass_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{websocket_platform-release_shared-pass_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{control-center_platform-release_shared-pass_keystore-key_keystore_pass\}'

  - it: Three services sharing same truststorePasswordSecretName - full deduplication
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "truststore-key"
        - type: websocket
          exposed: true
          containerPort: 8000
          keystoreSecretName: "keystore-2"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "truststore-key"
        - type: control-center
          exposed: true
          containerPort: 8080
          keystoreSecretName: "keystore-3"
          keystorePassword: "a2V5LWNoYW5nZW1lCg==" # key-changeme
          truststoreSecretName: "truststore-3"
          truststorePasswordSecretName: "shared-trust-pass"
          truststorePasswordSecretKey: "truststore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-trust-pass_truststore-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{websocket_platform-release_shared-trust-pass_truststore-key_truststore_pass\}'
      - notMatchRegex:
          path: data["config.xml"]
          pattern: '\$\{control-center_platform-release_shared-trust-pass_truststore-key_truststore_pass\}'

  - it: Three services with progressive sharing - service 1&2 share keystore pass, service 2&3 share truststore pass
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "shared-keystore-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "trust-pass-1"
          truststorePasswordSecretKey: "truststore-key"
        - type: websocket
          exposed: true
          containerPort: 8000
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "shared-keystore-pass"
          keystorePasswordSecretKey: "keystore-key"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "shared-truststore-pass"
          truststorePasswordSecretKey: "truststore-key"
        - type: control-center
          exposed: true
          containerPort: 8080
          keystoreSecretName: "keystore-3"
          keystorePasswordSecretName: "keystore-pass-3"
          keystorePasswordSecretKey: "keystore-key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_shared-keystore-pass_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{websocket_platform-release_shared-keystore-pass_keystore-key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-1_truststore-key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{websocket_platform-release_shared-truststore-pass_truststore-key_truststore_pass\}'

  - it: Four services all sharing one master password secret for all passwords
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "master-password-secret"
          keystorePasswordSecretKey: "mqtt-keystore"
          keystorePrivatePasswordSecretKey: "mqtt-private"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "master-password-secret"
          truststorePasswordSecretKey: "mqtt-truststore"
        - type: websocket
          exposed: true
          containerPort: 8000
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "master-password-secret"
          keystorePasswordSecretKey: "ws-keystore"
          keystorePrivatePasswordSecretKey: "ws-private"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "master-password-secret"
          truststorePasswordSecretKey: "ws-truststore"
        - type: control-center
          exposed: true
          containerPort: 8080
          keystoreSecretName: "keystore-3"
          keystorePasswordSecretName: "master-password-secret"
          keystorePasswordSecretKey: "cc-keystore"
          keystorePrivatePasswordSecretKey: "cc-private"
          truststoreSecretName: "truststore-3"
          truststorePasswordSecretName: "master-password-secret"
          truststorePasswordSecretKey: "cc-truststore"
        - type: rest-api
          exposed: true
          containerPort: 8888
          keystoreSecretName: "keystore-4"
          keystorePasswordSecretName: "master-password-secret"
          keystorePasswordSecretKey: "api-keystore"
          keystorePrivatePasswordSecretKey: "api-private"
          truststoreSecretName: "truststore-4"
          truststorePasswordSecretName: "master-password-secret"
          truststorePasswordSecretKey: "api-truststore"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_master-password-secret_mqtt-keystore_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_master-password-secret_mqtt-private_keystore_private_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_master-password-secret_mqtt-truststore_truststore_pass\}'

  ################################################################################
  # EDGE CASES WITH SPECIAL CHARACTERS
  ################################################################################

  - it: dots in password secret keys for both keystore and truststore
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "pass-1"
          keystorePasswordSecretKey: "my.keystore.password"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "trust-pass-1"
          truststorePasswordSecretKey: "my.truststore.password"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "pass-2"
          keystorePasswordSecretKey: "another.keystore.key"
          keystorePrivatePasswordSecretKey: "another.private.key"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "trust-pass-2"
          truststorePasswordSecretKey: "another.truststore.key"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-1_my_keystore_password_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-2_another_keystore_key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-2_another_private_key_keystore_private_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-1_my_truststore_password_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-2_another_truststore_key_truststore_pass\}'

  - it: hyphens in secret names for keystore and truststore
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-with-hyphens"
          keystorePasswordSecretName: "pass-with-hyphens"
          keystorePasswordSecretKey: "key-with-hyphens"
          truststoreSecretName: "truststore-with-hyphens"
          truststorePasswordSecretName: "trust-pass-with-hyphens"
          truststorePasswordSecretKey: "trust-key-with-hyphens"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "another-keystore-hyphens"
          keystorePasswordSecretName: "another-pass-hyphens"
          keystorePasswordSecretKey: "another-key-hyphens"
          truststoreSecretName: "another-truststore-hyphens"
          truststorePasswordSecretName: "another-trust-pass-hyphens"
          truststorePasswordSecretKey: "another-trust-key-hyphens"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-with-hyphens_key-with-hyphens_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_another-pass-hyphens_another-key-hyphens_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-pass-with-hyphens_trust-key-with-hyphens_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_another-trust-pass-hyphens_another-trust-key-hyphens_truststore_pass\}'

  - it: mix of dots and hyphens in all secret keys
    set:
      services:
        - type: mqtt
          exposed: true
          containerPort: 1883
          keystoreSecretName: "keystore-1"
          keystorePasswordSecretName: "pass-secret-1"
          keystorePasswordSecretKey: "my.keystore-password.key"
          keystorePrivatePasswordSecretKey: "my.private-key.password"
          truststoreSecretName: "truststore-1"
          truststorePasswordSecretName: "trust-secret-1"
          truststorePasswordSecretKey: "my.truststore-password.key"
        - type: mqtt
          exposed: true
          containerPort: 1884
          keystoreSecretName: "keystore-2"
          keystorePasswordSecretName: "pass-secret-2"
          keystorePasswordSecretKey: "another.keystore-key.format"
          truststoreSecretName: "truststore-2"
          truststorePasswordSecretName: "trust-secret-2"
          truststorePasswordSecretKey: "another.truststore-key.format"
    asserts:
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_my_keystore-password_key_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-1_my_private-key_password_keystore_private_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_pass-secret-2_another_keystore-key_format_keystore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-secret-1_my_truststore-password_key_truststore_pass\}'
      - matchRegex:
          path: data["config.xml"]
          pattern: '\$\{mqtt_platform-release_trust-secret-2_another_truststore-key_format_truststore_pass\}'
