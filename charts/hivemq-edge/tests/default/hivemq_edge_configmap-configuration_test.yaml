suite: HiveMQ Edge - Configmap Config tests

templates:
  - configmap-configuration.yml
release:
  name: edge
  namespace: hivemq-edge-namespace
chart:
  version: 0.0.1
  appVersion: "2367.359"

tests:
  - it: Should have the correct metadata
    asserts:
      - equal:
          path: metadata.name
          value: hivemq-edge-config-edge
      - equal:
          path: metadata.namespace
          value: hivemq-edge-namespace
      - equal:
          path: metadata.labels["helm.sh/chart"]
          value: hivemq-edge-0.0.1
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: hivemq-edge
      - equal:
          path: metadata.labels["app.kubernetes.io/instance"]
          value: edge
      - equal:
          path: metadata.labels["app.kubernetes.io/version"]
          value: "2367.359"
      - equal:
          path: metadata.labels["app.kubernetes.io/managed-by"]
          value: Helm

  - it: Should have the correct config data when configCompressed is set
    set:
      configCompressed: UEsDBBQAAAAIACd98Vrve9nWKQAAAEgAAAADABwAY2ZnVVQJAAN5/Xhoe/14aHV4CwABBPYBAAAEFAAAALPJLSwp0U0qykxJTy2247LRR+MXFOWX5Cfn5+gmpiQWlKQWgdVgEQQAUEsBAh4DFAAAAAgAJ33xWu972dYpAAAASAAAAAMAGAAAAAAAAQAAAKSBAAAAAGNmZ1VUBQADef14aHV4CwABBPYBAAAEFAAAAFBLBQYAAAAAAQABAEkAAABmAAAAAAA=
    asserts:
      - equal:
          path: data.config
          value: |
            UEsDBBQAAAAIACd98Vrve9nWKQAAAEgAAAADABwAY2ZnVVQJAAN5/Xhoe/14aHV4CwABBPYBAAAEFAAAALPJLSwp0U0qykxJTy2247LRR+MXFOWX5Cfn5+gmpiQWlKQWgdVgEQQAUEsBAh4DFAAAAAgAJ33xWu972dYpAAAASAAAAAMAGAAAAAAAAQAAAKSBAAAAAGNmZ1VUBQADef14aHV4CwABBPYBAAAEFAAAAFBLBQYAAAAAAQABAEkAAABmAAAAAAA=

  - it: Should fail if config and configCompressed are both set
    set:
      config: |
        <mqtt-bridges>
        </mqtt-bridges>
        <protocol-adapters>
        </protocol-adapters>
      configCompressed: UEsDBBQAAAAIACd98Vrve9nWKQAAAEgAAAADABwAY2ZnVVQJAAN5/Xhoe/14aHV4CwABBPYBAAAEFAAAALPJLSwp0U0qykxJTy2247LRR+MXFOWX5Cfn5+gmpiQWlKQWgdVgEQQAUEsBAh4DFAAAAAgAJ33xWu972dYpAAAASAAAAAMAGAAAAAAAAQAAAKSBAAAAAGNmZ1VUBQADef14aHV4CwABBPYBAAAEFAAAAFBLBQYAAAAAAQABAEkAAABmAAAAAAA=
    asserts:
      - failedTemplate:
          contains: "Must not validate the schema (not)"
